<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniConvert - Secure Client-Side Converter</title>
    <meta name="description" content="Convert Word to PDF, Merge PDFs, and more. 100% Client-side and secure.">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Processing Libraries -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* Smooth fade-in */
        body { opacity: 0; animation: fadeIn 0.5s ease-in forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons ---
        const IconWrapper = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const FileText = (props) => <IconWrapper {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></IconWrapper>;
        const Layers = (props) => <IconWrapper {...props}><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></IconWrapper>;
        const ImageIcon = (props) => <IconWrapper {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></IconWrapper>;
        const Download = (props) => <IconWrapper {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconWrapper>;
        const X = (props) => <IconWrapper {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconWrapper>;
        const Upload = (props) => <IconWrapper {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></IconWrapper>;
        const Loader2 = (props) => <IconWrapper {...props} className="animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></IconWrapper>;
        const FileType = (props) => <IconWrapper {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M9 13v-1h6v1"/><path d="M12 18v-6"/></IconWrapper>;

        function App() {
            const [activeTab, setActiveTab] = useState('merge');
            const [files, setFiles] = useState([]);
            const [isProcessing, setIsProcessing] = useState(false);
            const [downloadUrl, setDownloadUrl] = useState(null);
            const [downloadName, setDownloadName] = useState('');
            const [error, setError] = useState('');
            const [isDragging, setIsDragging] = useState(false);
            
            const fileInputRef = useRef(null);

            useEffect(() => {
                return () => { if (downloadUrl) URL.revokeObjectURL(downloadUrl); };
            }, [downloadUrl]);

            useEffect(() => {
                setFiles([]);
                setDownloadUrl(null);
                setError('');
            }, [activeTab]);

            // --- File Validation Helper ---
            const validateAndSetFiles = (incomingFiles) => {
                if (incomingFiles.length === 0) return;
                
                let validFiles = [];
                
                if (activeTab === 'merge') {
                    validFiles = incomingFiles.filter(f => f.type === 'application/pdf' || f.name.toLowerCase().endsWith('.pdf'));
                    if (validFiles.length !== incomingFiles.length) setError("Some non-PDF files were ignored.");
                    setFiles(prev => [...prev, ...validFiles]);
                } 
                else if (activeTab === 'word2pdf') {
                    const file = incomingFiles[0];
                    if (file.name.match(/\.docx?$/i)) {
                        setFiles([file]);
                    } else {
                        setError("Please upload a valid Word (.docx) file.");
                    }
                } 
                else if (activeTab === 'img2pdf') {
                    validFiles = incomingFiles.filter(f => f.type.startsWith('image/'));
                    if (validFiles.length === 0) setError("Please upload valid image files (JPG/PNG).");
                    setFiles(prev => [...prev, ...validFiles]);
                }
            };

            const handleFileChange = (e) => {
                const newFiles = Array.from(e.target.files || []);
                validateAndSetFiles(newFiles);
            };

            // --- Drag & Drop Handlers ---
            const onDragOver = (e) => { e.preventDefault(); setIsDragging(true); };
            const onDragLeave = (e) => { e.preventDefault(); setIsDragging(false); };
            const onDrop = (e) => {
                e.preventDefault();
                setIsDragging(false);
                const droppedFiles = Array.from(e.dataTransfer.files);
                validateAndSetFiles(droppedFiles);
            };

            const removeFile = (index) => {
                setFiles(prev => prev.filter((_, i) => i !== index));
            };

            // --- 1. MERGE PDFs ---
            const mergePDFs = async () => {
                if (files.length < 2) {
                    setError("Please select at least 2 PDF files.");
                    return;
                }
                setIsProcessing(true);
                setError('');
                try {
                    const { PDFDocument } = window.PDFLib; 
                    const mergedPdf = await PDFDocument.create();

                    for (const file of files) {
                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await PDFDocument.load(arrayBuffer);
                        const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                        copiedPages.forEach((page) => mergedPdf.addPage(page));
                    }

                    const pdfBytes = await mergedPdf.save();
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    setDownloadUrl(URL.createObjectURL(blob));
                    setDownloadName(`merged-${Date.now()}.pdf`);
                } catch (err) {
                    setError("Merge failed. Ensure PDFs are not password protected.");
                    console.error(err);
                }
                setIsProcessing(false);
            };

            // --- 2. WORD TO PDF ---
            const convertWordToPDF = async () => {
                if (files.length === 0) return;
                setIsProcessing(true);
                setError('');
                try {
                    const file = files[0];
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await window.mammoth.extractRawText({ arrayBuffer });
                    const text = result.value;
                    if(!text.trim()) throw new Error("No text found");

                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    const splitText = doc.splitTextToSize(text, 180);
                    doc.text(splitText, 10, 10);
                    
                    const pdfBlob = doc.output('blob');
                    setDownloadUrl(URL.createObjectURL(pdfBlob));
                    setDownloadName(file.name.replace(/\.docx?$/i, '.pdf'));
                } catch (err) {
                    setError("Conversion failed. Ensure the file is a valid .docx");
                }
                setIsProcessing(false);
            };

            // --- 3. IMAGES TO PDF ---
            const convertImageToPDF = async () => {
                if (files.length === 0) return;
                setIsProcessing(true);
                setError('');
                try {
                    const { PDFDocument } = window.PDFLib;
                    const pdfDoc = await PDFDocument.create();
                    for (const file of files) {
                        const imageBytes = await file.arrayBuffer();
                        let image;
                        if (file.type === 'image/jpeg' || file.name.match(/\.jpe?g$/i)) {
                            image = await pdfDoc.embedJpg(imageBytes);
                        } else if (file.type === 'image/png' || file.name.match(/\.png$/i)) {
                            image = await pdfDoc.embedPng(imageBytes);
                        } else continue;

                        const page = pdfDoc.addPage([image.width, image.height]);
                        page.drawImage(image, { x: 0, y: 0, width: image.width, height: image.height });
                    }
                    if (pdfDoc.getPageCount() === 0) throw new Error("No valid images");
                    const pdfBytes = await pdfDoc.save();
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    setDownloadUrl(URL.createObjectURL(blob));
                    setDownloadName('images-converted.pdf');
                } catch (err) { setError("Failed to convert images."); }
                setIsProcessing(false);
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800 pb-12">
                    <header className="bg-white border-b border-slate-200 px-4 md:px-6 py-4 flex items-center justify-between shadow-sm sticky top-0 z-10">
                        <div className="flex items-center gap-2">
                            <div className="bg-blue-600 text-white p-2 rounded-lg">
                                <FileType size={24} />
                            </div>
                            <h1 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600">
                                UniConvert
                            </h1>
                        </div>
                        <div className="text-xs md:text-sm text-slate-500 font-medium">
                           <span className="text-green-600 font-bold">‚óè</span> Client-side Secure
                        </div>
                    </header>

                    <main className="max-w-4xl mx-auto p-4 md:p-6">
                        <div className="flex flex-wrap gap-2 mb-8 justify-center">
                            {[
                                { id: 'merge', icon: Layers, label: 'Merge PDFs' },
                                { id: 'word2pdf', icon: FileText, label: 'Word to PDF' },
                                { id: 'img2pdf', icon: ImageIcon, label: 'Images to PDF' },
                            ].map((tab) => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex items-center gap-2 px-4 py-2 md:px-6 md:py-3 rounded-xl font-medium transition-all duration-200 text-sm md:text-base ${
                                        activeTab === tab.id
                                            ? 'bg-blue-600 text-white shadow-lg shadow-blue-600/20 transform scale-105'
                                            : 'bg-white text-slate-600 hover:bg-slate-100 border border-slate-200'
                                    }`}
                                >
                                    <tab.icon size={18} />
                                    {tab.label}
                                </button>
                            ))}
                        </div>

                        <div className="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden flex flex-col min-h-[400px]">
                            <div className="p-6 md:p-8 bg-slate-50/50 border-b border-slate-100">
                                <div 
                                    onDragOver={onDragOver}
                                    onDragLeave={onDragLeave}
                                    onDrop={onDrop}
                                    onClick={() => fileInputRef.current.click()}
                                    className={`
                                        border-2 border-dashed rounded-2xl p-8 md:p-10 text-center 
                                        transition-all cursor-pointer group relative
                                        ${isDragging 
                                            ? 'border-blue-600 bg-blue-50 scale-[1.02]' 
                                            : 'border-slate-300 hover:border-blue-500 hover:bg-blue-50'}
                                    `}
                                >
                                    <div className="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                                        <Upload size={32} />
                                    </div>
                                    <h3 className="text-lg font-semibold text-slate-700 mb-2">
                                        {isDragging ? 'Drop files now!' : 
                                         activeTab === 'merge' ? 'Drop multiple PDFs here' : 
                                         activeTab === 'word2pdf' ? 'Drop a Word (.docx) file' : 
                                         'Drop Images (JPG/PNG)'}
                                    </h3>
                                    <p className="text-slate-500 text-sm">or click to browse files</p>
                                    <input 
                                        type="file" ref={fileInputRef} onChange={handleFileChange}
                                        multiple={activeTab !== 'word2pdf'}
                                        accept={activeTab === 'merge' ? '.pdf' : activeTab === 'word2pdf' ? '.docx' : 'image/png, image/jpeg, image/jpg'}
                                        className="hidden" 
                                    />
                                </div>
                            </div>

                            <div className="flex-1 p-6">
                                {files.length > 0 ? (
                                    <div className="space-y-2 max-h-[300px] overflow-y-auto custom-scrollbar">
                                        {files.map((file, idx) => (
                                            <div key={idx} className="flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200 animate-fadeIn">
                                                <div className="flex items-center gap-3 overflow-hidden">
                                                    <div className="bg-white p-2 rounded border border-slate-200 text-slate-500">
                                                        {activeTab === 'img2pdf' ? <ImageIcon size={16}/> : <FileText size={16}/>}
                                                    </div>
                                                    <div className="flex flex-col min-w-0">
                                                        <span className="text-sm font-medium truncate max-w-[150px] md:max-w-xs">{file.name}</span>
                                                        <span className="text-xs text-slate-400">{(file.size / 1024).toFixed(1)} KB</span>
                                                    </div>
                                                </div>
                                                <button onClick={() => removeFile(idx)} className="text-slate-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-full transition-colors"><X size={18} /></button>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="h-full flex flex-col items-center justify-center text-slate-400 italic min-h-[100px]">No files selected yet.</div>
                                )}
                            </div>

                            <div className="p-6 bg-slate-50 border-t border-slate-100 flex flex-col md:flex-row items-center justify-between gap-4">
                                {error && <div className="w-full md:w-auto flex-1 text-red-500 text-sm bg-red-50 px-4 py-3 rounded-lg border border-red-100 flex items-center gap-2"><span className="font-bold">Error:</span> {error}</div>}

                                <div className="flex flex-col md:flex-row gap-3 w-full md:w-auto md:ml-auto">
                                    <button onClick={() => setFiles([])} disabled={files.length === 0 || isProcessing} className="px-6 py-3 rounded-xl font-medium text-slate-600 hover:bg-slate-200 disabled:opacity-50 transition-colors">Clear All</button>
                                    
                                    {!downloadUrl ? (
                                        <button
                                            onClick={activeTab === 'merge' ? mergePDFs : activeTab === 'word2pdf' ? convertWordToPDF : convertImageToPDF}
                                            disabled={files.length === 0 || isProcessing}
                                            className="flex-1 md:flex-none px-8 py-3 bg-blue-600 text-white rounded-xl font-medium shadow-lg shadow-blue-600/30 hover:bg-blue-700 disabled:opacity-50 disabled:shadow-none flex items-center justify-center gap-2 transition-all"
                                        >
                                            {isProcessing ? (
                                                <><Loader2 size={20} className="animate-spin" /> Processing...</>
                                            ) : (
                                                <>
                                                    {/* DYNAMIC BUTTON TEXT LOGIC */}
                                                    {activeTab === 'merge' ? 'Merge PDFs' : 'Convert to PDF'}
                                                </>
                                            )}
                                        </button>
                                    ) : (
                                        <a
                                            href={downloadUrl}
                                            download={downloadName}
                                            className="flex-1 md:flex-none px-8 py-3 bg-green-600 text-white rounded-xl font-medium shadow-lg shadow-green-600/30 hover:bg-green-700 flex items-center justify-center gap-2 animate-bounce"
                                            onClick={() => setTimeout(() => setDownloadUrl(null), 2000)}
                                        >
                                            <Download size={20} /> Download
                                        </a>
                                    )}
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>